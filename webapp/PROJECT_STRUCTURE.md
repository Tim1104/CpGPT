# CpGPT Web åº”ç”¨é¡¹ç›®ç»“æ„

## ğŸ“ ç›®å½•ç»“æ„

```
webapp/
â”œâ”€â”€ app.py                      # FastAPIä¸»åº”ç”¨ï¼ˆåç«¯æ ¸å¿ƒï¼‰
â”œâ”€â”€ report_generator.py         # HTMLæŠ¥å‘Šå’Œå¯è§†åŒ–ç”Ÿæˆå™¨
â”œâ”€â”€ pdf_generator.py            # PDFè½¬æ¢å·¥å…·
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–åˆ—è¡¨
â”œâ”€â”€ start_server.sh            # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_webapp.py             # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ README.md                  # å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md              # å¿«é€Ÿå…¥é—¨æŒ‡å—
â”œâ”€â”€ PROJECT_STRUCTURE.md       # æœ¬æ–‡ä»¶
â”œâ”€â”€ static/                    # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html            # ä¸»é¡µé¢
â”‚   â””â”€â”€ app.js                # å‰ç«¯JavaScripté€»è¾‘
â”œâ”€â”€ uploads/                   # ä¸Šä¼ æ–‡ä»¶å­˜å‚¨ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ results/                   # åˆ†æç»“æœå­˜å‚¨ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â””â”€â”€ {task_id}/            # æ¯ä¸ªä»»åŠ¡çš„ç»“æœç›®å½•
â”‚       â”œâ”€â”€ processed/        # å¤„ç†åçš„æ•°æ®
â”‚       â”œâ”€â”€ figures/          # ç”Ÿæˆçš„å›¾è¡¨
â”‚       â”‚   â”œâ”€â”€ age_distribution.png
â”‚       â”‚   â”œâ”€â”€ cancer_distribution.png
â”‚       â”‚   â”œâ”€â”€ age_cancer_correlation.png
â”‚       â”‚   â””â”€â”€ summary_statistics.png
â”‚       â”œâ”€â”€ analysis_report.html  # HTMLæŠ¥å‘Š
â”‚       â”œâ”€â”€ analysis_report.pdf   # PDFæŠ¥å‘Šï¼ˆæŒ‰éœ€ç”Ÿæˆï¼‰
â”‚       â””â”€â”€ combined_predictions.csv  # é¢„æµ‹ç»“æœCSV
â””â”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â””â”€â”€ cpgpt_web_YYYYMMDD.log
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. app.py - FastAPIåç«¯

**ä¸»è¦åŠŸèƒ½:**
- æ–‡ä»¶ä¸Šä¼ å¤„ç†
- å¼‚æ­¥ä»»åŠ¡ç®¡ç†
- 935kæ•°æ®åˆ†ææµç¨‹
- APIç«¯ç‚¹å®ç°
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**å…³é”®ç±»å’Œå‡½æ•°:**
```python
# é…ç½®
DEPENDENCIES_DIR = "./dependencies"
UPLOAD_DIR = "./webapp/uploads"
RESULTS_DIR = "./webapp/results"
MAX_INPUT_LENGTH = 30000

# æ ¸å¿ƒå‡½æ•°
async def analyze_935k_data(task_id, file_path)  # ä¸»åˆ†ææµç¨‹
async def predict_age(...)                        # å¹´é¾„é¢„æµ‹
async def predict_cancer(...)                     # ç™Œç—‡é¢„æµ‹

# APIç«¯ç‚¹
@app.post("/api/upload")                         # æ–‡ä»¶ä¸Šä¼ 
@app.get("/api/task/{task_id}")                  # è·å–ä»»åŠ¡çŠ¶æ€
@app.get("/api/download/{task_id}/pdf")          # ä¸‹è½½PDF
@app.delete("/api/task/{task_id}")               # åˆ é™¤ä»»åŠ¡
@app.get("/health")                              # å¥åº·æ£€æŸ¥
```

**æ•°æ®æµ:**
```
ä¸Šä¼ æ–‡ä»¶ â†’ CSVè½¬Arrow â†’ æ•°æ®å¤„ç† â†’ DNAåµŒå…¥ â†’ 
å¹´é¾„é¢„æµ‹ â†’ ç™Œç—‡é¢„æµ‹ â†’ ç”ŸæˆæŠ¥å‘Š â†’ è¿”å›ç»“æœ
```

### 2. report_generator.py - æŠ¥å‘Šç”Ÿæˆå™¨

**ä¸»è¦åŠŸèƒ½:**
- åˆ›å»ºå¯è§†åŒ–å›¾è¡¨ï¼ˆmatplotlib/seabornï¼‰
- ç”ŸæˆHTMLæŠ¥å‘Š
- ç»Ÿè®¡åˆ†æå’Œè§£è¯»

**ç”Ÿæˆçš„å›¾è¡¨:**
1. **age_distribution.png** - å¹´é¾„åˆ†å¸ƒç›´æ–¹å›¾å’Œç®±çº¿å›¾
2. **cancer_distribution.png** - ç™Œç—‡æ¦‚ç‡åˆ†å¸ƒå’Œåˆ†ç±»é¥¼å›¾
3. **age_cancer_correlation.png** - å¹´é¾„ä¸ç™Œç—‡ç›¸å…³æ€§åˆ†æ
4. **summary_statistics.png** - ç»¼åˆç»Ÿè®¡åˆ†æå›¾è¡¨

**å…³é”®å‡½æ•°:**
```python
def create_age_distribution_plot(age_results, save_path)
def create_cancer_distribution_plot(cancer_results, save_path)
def create_age_cancer_correlation_plot(combined_results, save_path)
def create_summary_statistics_plot(combined_results, save_path)
def create_visualizations(combined_results, age_results, cancer_results, figures_dir)
def generate_html_report(combined_results, report_path, figures_dir)
```

### 3. pdf_generator.py - PDFè½¬æ¢å™¨

**ä¸»è¦åŠŸèƒ½:**
- HTMLè½¬PDFè½¬æ¢
- æ”¯æŒå¤šç§è½¬æ¢å·¥å…·ï¼ˆweasyprint/wkhtmltopdfï¼‰

**å…³é”®å‡½æ•°:**
```python
def generate_pdf_report(html_path, pdf_path)
def generate_pdf_report_alternative(html_path, pdf_path)  # å¤‡ç”¨æ–¹æ³•
```

### 4. static/index.html - å‰ç«¯é¡µé¢

**ä¸»è¦åŠŸèƒ½:**
- æ–‡ä»¶ä¸Šä¼ ç•Œé¢
- æ‹–æ‹½ä¸Šä¼ æ”¯æŒ
- è¿›åº¦æ˜¾ç¤º
- æŠ¥å‘Šé¢„è§ˆ
- PDFä¸‹è½½

**UIç»„ä»¶:**
- ä¸Šä¼ åŒºåŸŸï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰
- è¿›åº¦æ¡å’ŒçŠ¶æ€æ˜¾ç¤º
- ç»“æœæŒ‰é’®ï¼ˆæŸ¥çœ‹æŠ¥å‘Šã€ä¸‹è½½PDFã€åˆ†ææ–°æ–‡ä»¶ï¼‰
- æŠ¥å‘Šé¢„è§ˆiframe
- é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º

### 5. static/app.js - å‰ç«¯é€»è¾‘

**ä¸»è¦åŠŸèƒ½:**
- æ–‡ä»¶é€‰æ‹©å’ŒéªŒè¯
- æ‹–æ‹½ä¸Šä¼ å¤„ç†
- å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ 
- ä»»åŠ¡çŠ¶æ€è½®è¯¢
- è¿›åº¦æ›´æ–°
- æŠ¥å‘Šæ˜¾ç¤ºå’ŒPDFä¸‹è½½

**å…³é”®å‡½æ•°:**
```javascript
function uploadFile()           // ä¸Šä¼ æ–‡ä»¶
function checkTaskStatus()      // æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
function updateProgress(task)   // æ›´æ–°è¿›åº¦æ˜¾ç¤º
function viewReport()           // æŸ¥çœ‹æŠ¥å‘Š
function downloadPDF()          // ä¸‹è½½PDF
function resetPage()            // é‡ç½®é¡µé¢
```

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### ç”¨æˆ·è§†è§’

```
1. æ‰“å¼€æµè§ˆå™¨ â†’ http://localhost:8000
2. é€‰æ‹©/æ‹–æ‹½æ–‡ä»¶ â†’ ç‚¹å‡»"å¼€å§‹åˆ†æ"
3. ç­‰å¾…åˆ†æï¼ˆå®æ—¶è¿›åº¦æ˜¾ç¤ºï¼‰
4. æŸ¥çœ‹HTMLæŠ¥å‘Š / ä¸‹è½½PDF
5. åˆ†ææ–°æ–‡ä»¶æˆ–å…³é—­
```

### ç³»ç»Ÿè§†è§’

```
1. å‰ç«¯: æ–‡ä»¶ä¸Šä¼  â†’ POST /api/upload
2. åç«¯: ä¿å­˜æ–‡ä»¶ â†’ åˆ›å»ºä»»åŠ¡ â†’ å¯åŠ¨å¼‚æ­¥åˆ†æ
3. åˆ†ææµç¨‹:
   - åˆå§‹åŒ–ç¯å¢ƒå’Œæ¨¡å‹
   - è½¬æ¢æ•°æ®æ ¼å¼ï¼ˆCSVâ†’Arrowï¼‰
   - å¤„ç†ç”²åŸºåŒ–æ•°æ®
   - ç”ŸæˆDNAåµŒå…¥
   - æ‰§è¡Œå¹´é¾„é¢„æµ‹
   - æ‰§è¡Œç™Œç—‡é¢„æµ‹
   - ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
   - ç”ŸæˆHTMLæŠ¥å‘Š
4. å‰ç«¯: è½®è¯¢ä»»åŠ¡çŠ¶æ€ â†’ GET /api/task/{task_id}
5. å®Œæˆ: æ˜¾ç¤ºæŠ¥å‘Š â†’ å¯ä¸‹è½½PDF
```

## ğŸ“Š æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ä¸Šä¼    â”‚
â”‚  CSV/Arrow  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶éªŒè¯å’Œä¿å­˜  â”‚
â”‚  (app.py)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºåˆ†æä»»åŠ¡   â”‚
â”‚  (å¼‚æ­¥)         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®é¢„å¤„ç†     â”‚
â”‚  CpGPTDataSaver â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DNAåµŒå…¥ç”Ÿæˆ    â”‚
â”‚  DNALLMEmbedder â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚
       â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¹´é¾„é¢„æµ‹ â”‚      â”‚ ç™Œç—‡é¢„æµ‹ â”‚
â”‚ age_cot  â”‚      â”‚ cancer   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  åˆå¹¶ç»“æœ      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ç”Ÿæˆå¯è§†åŒ–    â”‚
     â”‚  (matplotlib)  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ç”ŸæˆHTMLæŠ¥å‘Š  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  è¿”å›ç»™ç”¨æˆ·    â”‚
     â”‚  (å¯ä¸‹è½½PDF)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”Œ APIç«¯ç‚¹è¯¦è§£

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|------|
| `/` | GET | ä¸»é¡µ | - | HTMLé¡µé¢ |
| `/api/upload` | POST | ä¸Šä¼ æ–‡ä»¶ | æ–‡ä»¶(multipart) | task_id |
| `/api/task/{task_id}` | GET | è·å–ä»»åŠ¡çŠ¶æ€ | task_id | ä»»åŠ¡ä¿¡æ¯ |
| `/api/tasks` | GET | åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡ | - | ä»»åŠ¡åˆ—è¡¨ |
| `/results/{task_id}/analysis_report.html` | GET | è·å–HTMLæŠ¥å‘Š | task_id | HTMLæ–‡ä»¶ |
| `/results/{task_id}/figures/{filename}` | GET | è·å–å›¾è¡¨ | task_id, filename | å›¾ç‰‡æ–‡ä»¶ |
| `/api/download/{task_id}/pdf` | GET | ä¸‹è½½PDF | task_id | PDFæ–‡ä»¶ |
| `/api/task/{task_id}` | DELETE | åˆ é™¤ä»»åŠ¡ | task_id | æˆåŠŸæ¶ˆæ¯ |
| `/health` | GET | å¥åº·æ£€æŸ¥ | - | ç³»ç»ŸçŠ¶æ€ |
| `/docs` | GET | APIæ–‡æ¡£ | - | Swagger UI |

## ğŸ¨ å‰ç«¯ç»„ä»¶

### HTMLç»“æ„
```html
<div class="container">
  <div class="header">...</div>
  <div class="main-card">
    <div class="upload-section">...</div>
    <div class="progress-section">...</div>
    <div class="result-section">...</div>
    <div class="error-message">...</div>
  </div>
  <div class="info-section">...</div>
  <div class="footer">...</div>
</div>
```

### CSSæ ·å¼ç‰¹ç‚¹
- æ¸å˜èƒŒæ™¯ï¼ˆç´«è‰²ä¸»é¢˜ï¼‰
- å¡ç‰‡å¼è®¾è®¡
- å“åº”å¼å¸ƒå±€
- åŠ¨ç”»æ•ˆæœï¼ˆè¿›åº¦æ¡ã€æŒ‰é’®æ‚¬åœï¼‰
- æ‹–æ‹½ä¸Šä¼ è§†è§‰åé¦ˆ

## ğŸ“ æ—¥å¿—ç³»ç»Ÿ

### æ—¥å¿—çº§åˆ«
- **INFO**: æ­£å¸¸æ“ä½œï¼ˆæ–‡ä»¶ä¸Šä¼ ã€ä»»åŠ¡åˆ›å»ºã€åˆ†ææ­¥éª¤ï¼‰
- **WARNING**: è­¦å‘Šä¿¡æ¯ï¼ˆä»»åŠ¡æœªæ‰¾åˆ°ã€æ ¼å¼é”™è¯¯ï¼‰
- **ERROR**: é”™è¯¯ä¿¡æ¯ï¼ˆåˆ†æå¤±è´¥ã€å¼‚å¸¸ï¼‰
- **DEBUG**: è°ƒè¯•ä¿¡æ¯ï¼ˆå¥åº·æ£€æŸ¥ï¼‰

### æ—¥å¿—ä½ç½®
- æ–‡ä»¶: `webapp/logs/cpgpt_web_YYYYMMDD.log`
- æ§åˆ¶å°: å®æ—¶è¾“å‡º

### æ—¥å¿—æ ¼å¼
```
2024-11-04 10:30:45 - cpgpt_web - INFO - [Task abc123] Starting analysis...
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **æ–‡ä»¶å¤§å°é™åˆ¶**: æœ€å¤§500MB
2. **æ–‡ä»¶æ ¼å¼éªŒè¯**: ä»…å…è®¸CSV/Arrowæ ¼å¼
3. **ä»»åŠ¡éš”ç¦»**: æ¯ä¸ªä»»åŠ¡ç‹¬ç«‹ç›®å½•
4. **é”™è¯¯å¤„ç†**: å…¨å±€å¼‚å¸¸æ•è·
5. **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ“ä½œå®¡è®¡

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨asyncioé¿å…é˜»å¡
2. **æ‰¹å¤„ç†**: å¯é…ç½®çš„batch_size
3. **ç¼“å­˜**: DNAåµŒå…¥ç¼“å­˜
4. **æ··åˆç²¾åº¦**: 16-bitè®­ç»ƒåŠ é€Ÿ
5. **GPUåŠ é€Ÿ**: è‡ªåŠ¨æ£€æµ‹å’Œä½¿ç”¨GPU

## ğŸ“¦ ä¾èµ–ç®¡ç†

### æ ¸å¿ƒä¾èµ–
- **fastapi**: Webæ¡†æ¶
- **uvicorn**: ASGIæœåŠ¡å™¨
- **pandas**: æ•°æ®å¤„ç†
- **torch**: æ·±åº¦å­¦ä¹ 
- **lightning**: è®­ç»ƒæ¡†æ¶
- **matplotlib/seaborn**: å¯è§†åŒ–

### å¯é€‰ä¾èµ–
- **weasyprint**: PDFç”Ÿæˆï¼ˆæ¨èï¼‰
- **pdfkit**: PDFç”Ÿæˆï¼ˆå¤‡é€‰ï¼‰

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬:
```bash
# åŸºç¡€æµ‹è¯•
python webapp/test_webapp.py

# å®Œæ•´æµ‹è¯•ï¼ˆåŒ…å«æ–‡ä»¶ä¸Šä¼ ï¼‰
python webapp/test_webapp.py /path/to/test_data.csv
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **README.md**: å®Œæ•´æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
- **QUICKSTART.md**: å¿«é€Ÿå…¥é—¨æŒ‡å—
- **PROJECT_STRUCTURE.md**: æœ¬æ–‡ä»¶ï¼ˆé¡¹ç›®ç»“æ„ï¼‰

---

**æœ€åæ›´æ–°**: 2024-11-04

