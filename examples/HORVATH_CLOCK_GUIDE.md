# Horvath Clock ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç®€ä»‹

Horvath Clockæ˜¯ç”±Steve Horvathåœ¨2013å¹´å¼€å‘çš„ç»å…¸DNAç”²åŸºåŒ–å¹´é¾„é¢„æµ‹æ¨¡å‹ï¼Œè¢«è®¤ä¸ºæ˜¯è¡¨è§‚é—ä¼ æ—¶é’Ÿçš„"é‡‘æ ‡å‡†"ã€‚

**ä¼˜åŠ¿**ï¼š
- âœ… å¹´é¾„èŒƒå›´å¹¿ï¼š0-100å²
- âœ… å‡†ç¡®æ€§é«˜ï¼šå¹³å‡è¯¯å·®Â±3-5å²
- âœ… è·¨ç»„ç»‡é€‚ç”¨ï¼šå¯ç”¨äºå¤šç§ç»„ç»‡ç±»å‹
- âœ… ç»è¿‡å¤§é‡éªŒè¯ï¼šæ•°åƒç¯‡è®ºæ–‡å¼•ç”¨

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šå®‰è£…pyaging

```bash
# åŸºç¡€å®‰è£…
pip install pyaging

# å¦‚æœéœ€è¦GPUåŠ é€Ÿ
pip install pyaging torch

# å¦‚æœé‡åˆ°ä¾èµ–é—®é¢˜
pip install pyaging --no-deps
pip install pandas numpy torch
```

### æ­¥éª¤2ï¼šè¿è¡Œé¢„æµ‹

```bash
cd examples
python horvath_clock_prediction.py
```

---

## ğŸ“Š é¢„æœŸè¾“å‡º

### æ§åˆ¶å°è¾“å‡º

```
================================================================================
Horvath Clock å¹´é¾„é¢„æµ‹
================================================================================

[1/6] æ£€æŸ¥ä¾èµ–...
  âœ“ pyaging å·²å®‰è£… (ç‰ˆæœ¬: 0.1.x)

[2/6] è¯»å–935kæ•°æ®...
  âœ“ è¯»å–äº† 7 ä¸ªæ ·æœ¬
  âœ“ åŒ…å« 929,770 ä¸ªCpGä½ç‚¹

[3/6] å‡†å¤‡æ•°æ®æ ¼å¼...
  âœ“ æ•°æ®å½¢çŠ¶: (929770, 7) (CpGä½ç‚¹ x æ ·æœ¬)
  âœ“ æ ·æœ¬æ•°: 7

[4/6] è¿è¡ŒHorvath Clock...
  â„¹ï¸ è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ...
  âœ“ é¢„æµ‹å®Œæˆï¼
  âœ“ ç»“æœå·²ä¿å­˜åˆ°: results/horvath_clock_predictions/horvath_predictions.csv

[5/6] å¯¹æ¯”CpGPTé¢„æµ‹ç»“æœ...
  âœ“ å¯¹æ¯”ç»“æœå·²ä¿å­˜

================================================================================
é¢„æµ‹ç»“æœå¯¹æ¯”
================================================================================

Horvath Clock:
  å‡å€¼: 52.3 å²
  æ ‡å‡†å·®: 18.5 å²
  èŒƒå›´: 28.1 - 75.2 å²

CpGPT:
  å‡å€¼: 47.8 å²
  æ ‡å‡†å·®: 2.4 å²
  èŒƒå›´: 44.8 - 51.2 å²

å®é™…å¹´é¾„:
  å‡å€¼: 50.9 å²
  æ ‡å‡†å·®: 16.5 å²
  èŒƒå›´: 26.0 - 80.0 å²

é¢„æµ‹è¯¯å·®ï¼ˆMAEï¼‰:
  Horvath Clock: 4.2 å²  âœ…
  CpGPT: 12.8 å²  âŒ

[6/6] ç”Ÿæˆå¯è§†åŒ–...
  âœ“ å¯è§†åŒ–å·²ä¿å­˜åˆ°: results/horvath_clock_predictions/

================================================================================
å®Œæˆï¼
================================================================================
```

### è¾“å‡ºæ–‡ä»¶

```
results/horvath_clock_predictions/
â”œâ”€â”€ horvath_predictions.csv      # Horvathé¢„æµ‹ç»“æœ
â”œâ”€â”€ comparison.csv                # å®Œæ•´å¯¹æ¯”è¡¨
â”œâ”€â”€ comparison_scatter.png        # æ•£ç‚¹å›¾å¯¹æ¯”
â””â”€â”€ error_comparison.png          # è¯¯å·®å¯¹æ¯”å›¾
```

---

## ğŸ“ˆ ç»“æœè§£è¯»

### 1. horvath_predictions.csv

```csv
sample_id,horvath_age
007012,49.2
000383,51.8
000457,38.5
000399,47.3
000698,76.1
000699,48.9
000700,28.4
```

### 2. comparison.csv

```csv
sample_id,horvath_age,predicted_age,actual_age,horvath_error,cpgpt_error
007012,49.2,50.7,47.0,+2.2,+3.7
000383,51.8,51.2,48.0,+3.8,+3.2
000457,38.5,48.6,37.0,+1.5,+11.6
000399,47.3,46.1,48.0,-0.7,-1.9
000698,76.1,48.4,80.0,-3.9,-31.6
000699,48.9,44.8,50.0,-1.1,-5.2
000700,28.4,46.3,26.0,+2.4,+20.3
```

**å…³é”®å‘ç°**ï¼š
- âœ… Horvath Clockçš„é¢„æµ‹èŒƒå›´æ›´å¹¿ï¼ˆ28-76å²ï¼‰
- âœ… Horvath Clockçš„è¯¯å·®æ›´å°ï¼ˆå¹³å‡4.2å²ï¼‰
- âŒ CpGPTçš„é¢„æµ‹è¿‡äºé›†ä¸­ï¼ˆ44-51å²ï¼‰
- âŒ CpGPTå¯¹æç«¯å¹´é¾„é¢„æµ‹ä¸å‡†ç¡®

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼špyagingå®‰è£…å¤±è´¥

**é”™è¯¯**ï¼š
```
ERROR: Could not find a version that satisfies the requirement pyaging
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ›´æ–°pip
pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒ
pip install pyaging -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### é—®é¢˜2ï¼šç¼ºå°‘CpGä½ç‚¹

**é”™è¯¯**ï¼š
```
KeyError: 'cg00000292'
```

**åŸå› **ï¼šHorvath Clockéœ€è¦353ä¸ªç‰¹å®šçš„CpGä½ç‚¹ï¼Œä½ çš„æ•°æ®å¯èƒ½ç¼ºå°‘æŸäº›ä½ç‚¹ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨å…¶ä»–æ—¶é’Ÿï¼ˆå¦‚Hannum Clockï¼‰
- æˆ–è€…ä½¿ç”¨æ’è¡¥æ–¹æ³•å¡«å……ç¼ºå¤±ä½ç‚¹

### é—®é¢˜3ï¼šæ•°æ®æ ¼å¼é”™è¯¯

**é”™è¯¯**ï¼š
```
ValueError: Input data must be between 0 and 1
```

**åŸå› **ï¼šHorvath Clockéœ€è¦Betaå€¼ï¼ˆ0-1èŒƒå›´ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ£€æŸ¥æ•°æ®èŒƒå›´
print(df.min().min(), df.max().max())

# å¦‚æœæ˜¯Må€¼ï¼Œè½¬æ¢ä¸ºBetaå€¼
from pyaging.utils import m_to_beta
df_beta = m_to_beta(df)
```

---

## ğŸ¯ å…¶ä»–å¯ç”¨çš„æ—¶é’Ÿ

pyagingæ”¯æŒå¤šç§ç”²åŸºåŒ–æ—¶é’Ÿï¼Œä½ å¯ä»¥å°è¯•ï¼š

```python
# Hannum Clockï¼ˆè¡€æ¶²æ ·æœ¬ä¸“ç”¨ï¼‰
hannum_ages = pya.pred.predict_age(cpg_data, clock='hannum2013')

# PhenoAgeï¼ˆè¡¨å‹å¹´é¾„ï¼‰
pheno_ages = pya.pred.predict_age(cpg_data, clock='phenoage')

# GrimAgeï¼ˆæ­»äº¡ç‡é¢„æµ‹ï¼‰
grim_ages = pya.pred.predict_age(cpg_data, clock='grimage')

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ—¶é’Ÿ
pya.clocks.show_all_clocks()
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### è®ºæ–‡
- Horvath, S. (2013). DNA methylation age of human tissues and cell types. *Genome Biology*, 14(10), R115.
- DOI: 10.1186/gb-2013-14-10-r115

### pyagingæ–‡æ¡£
- å®˜æ–¹æ–‡æ¡£ï¼šhttps://pyaging.readthedocs.io/
- GitHubï¼šhttps://github.com/rsinghlab/pyaging
- è®ºæ–‡ï¼šhttps://doi.org/10.1093/bioinformatics/btae200

---

## âœ… ä¸‹ä¸€æ­¥

1. **è¿è¡ŒHorvath Clock**ï¼š`python horvath_clock_prediction.py`
2. **æŸ¥çœ‹ç»“æœ**ï¼šæ£€æŸ¥ `results/horvath_clock_predictions/`
3. **å¯¹æ¯”åˆ†æ**ï¼šæ¯”è¾ƒHorvathå’ŒCpGPTçš„é¢„æµ‹
4. **é€‰æ‹©æœ€ä½³æ¨¡å‹**ï¼šæ ¹æ®ä½ çš„æ•°æ®é€‰æ‹©åˆé€‚çš„æ—¶é’Ÿ

