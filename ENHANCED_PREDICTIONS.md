# âœ… å¢å¼ºç‰ˆé¢„æµ‹åŠŸèƒ½è¯´æ˜

**æ›´æ–°æ—¶é—´**: 2025-11-07

---

## ğŸ¯ æ–°å¢åŠŸèƒ½

### 1. è¡¨è§‚é—ä¼ æ—¶é’Ÿé¢„æµ‹

ç°åœ¨è„šæœ¬ä¼šä½¿ç”¨ **clock_proxies** æ¨¡å‹é¢„æµ‹5ä¸ªç»å…¸çš„è¡¨è§‚é—ä¼ æ—¶é’Ÿï¼š

| æ—¶é’Ÿæ¨¡å‹ | å¼€å‘å¹´ä»½ | ç‰¹ç‚¹ | ä¸´åºŠæ„ä¹‰ |
|---------|---------|------|---------|
| **Horvath** | 2013 | å¤šç»„ç»‡é€šç”¨ | é¢„æµ‹å®é™…å¹´é¾„ï¼Œå‡†ç¡®åº¦é«˜ |
| **Hannum** | 2013 | è¡€æ¶²ç‰¹å¼‚æ€§ | ä¸å…ç–«ç³»ç»Ÿè¡°è€ç›¸å…³ |
| **PhenoAge** | 2018 | è¡¨å‹å¹´é¾„ | é¢„æµ‹æ­»äº¡ç‡å’Œå¥åº·çŠ¶æ€ |
| **GrimAge** | 2019 | å¯¿å‘½é¢„æµ‹ | ä¸å¸çƒŸã€ç–¾ç—…é£é™©ç›¸å…³ |
| **DunedinPACE** | 2022 | è¡°è€é€Ÿåº¦ | 1.0=æ­£å¸¸ï¼Œ>1.0=åŠ é€Ÿè¡°è€ |

### 2. å¢å¼ºçš„HTMLæŠ¥å‘Š

æŠ¥å‘Šç°åœ¨åŒ…å«ï¼š
- âœ… **æ¨¡å‹ä¿¡æ¯**ï¼šæ˜¾ç¤ºä½¿ç”¨çš„3ä¸ªAIæ¨¡å‹
- âœ… **è¡¨è§‚é—ä¼ æ—¶é’Ÿåˆ†æ**ï¼š5ä¸ªæ—¶é’Ÿçš„è¯¦ç»†ç»“æœ
- âœ… **æ—¶é’Ÿå¯¹æ¯”**ï¼šä¸åŒæ¨¡å‹é¢„æµ‹çš„ä¸€è‡´æ€§åˆ†æ
- âœ… **ä¸´åºŠè§£è¯»**ï¼šæ¯ä¸ªæ—¶é’Ÿçš„ç”Ÿç‰©å­¦æ„ä¹‰
- âœ… **å¹´é¾„åŠ é€Ÿåˆ†æ**ï¼šè¡¨è§‚é—ä¼ å¹´é¾„ vs å®é™…å¹´é¾„

### 3. æ•°æ®è´¨é‡æ£€æŸ¥

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥ï¼š
- âŒ è´Ÿæ•°å¹´é¾„é¢„æµ‹
- âŒ å¼‚å¸¸é«˜çš„å¹´é¾„ï¼ˆ>120å²ï¼‰
- âœ… ç‰¹å¾åŒ¹é…æ•°é‡
- âœ… é¢„æµ‹èŒƒå›´åˆç†æ€§

---

## ğŸ” å…³äºå¹´é¾„-1.6çš„é—®é¢˜

### å¯èƒ½çš„åŸå› 

#### 1. **æ•°æ®è´¨é‡é—®é¢˜**
```
å¯èƒ½åŸå› ï¼š
- ç¼ºå¤±å€¼è¿‡å¤šï¼ˆBetaå€¼ä¸ºNaNï¼‰
- å¼‚å¸¸å€¼ï¼ˆBetaå€¼ä¸åœ¨0-1èŒƒå›´ï¼‰
- æ¢é’ˆIDæ ¼å¼ä¸åŒ¹é…
```

**æ£€æŸ¥æ–¹æ³•**ï¼š
```python
import pandas as pd

# è¯»å–æ•°æ®
df = pd.read_csv("data/Sample-251107-Rico-1.csv")

# æ£€æŸ¥ç¼ºå¤±å€¼
print(f"ç¼ºå¤±å€¼æ¯”ä¾‹: {df.isnull().sum().sum() / df.size * 100:.2f}%")

# æ£€æŸ¥Betaå€¼èŒƒå›´
numeric_cols = df.select_dtypes(include=[np.number]).columns
for col in numeric_cols[:10]:
    print(f"{col}: min={df[col].min():.3f}, max={df[col].max():.3f}")

# æ£€æŸ¥æ¢é’ˆIDæ ¼å¼
print(f"åˆ—åç¤ºä¾‹: {list(df.columns[:5])}")
```

#### 2. **ç‰¹å¾åŒ¹é…ä¸è¶³**
```
å¯èƒ½åŸå› ï¼š
- 935kå¹³å°çš„æ¢é’ˆIDä¸æ¨¡å‹è®­ç»ƒæ•°æ®ä¸åŒ¹é…
- å¯ç”¨ç‰¹å¾æ•°é‡å¤ªå°‘ï¼ˆ<1000ä¸ªï¼‰
```

**æ£€æŸ¥è¾“å‡º**ï¼š
```
935kæ•°æ®ä¸­æœ‰ XXXX ä¸ªç‰¹å¾åœ¨æ¨¡å‹è¯æ±‡è¡¨ä¸­
```

**å»ºè®®**ï¼š
- å¦‚æœ < 1000ï¼šæ•°æ®è´¨é‡å·®æˆ–å¹³å°ä¸å…¼å®¹
- å¦‚æœ 1000-5000ï¼šå¯ç”¨ä½†é¢„æµ‹å¯èƒ½ä¸å‡†ç¡®
- å¦‚æœ > 5000ï¼šè‰¯å¥½

#### 3. **å¹³å°å·®å¼‚**
```
å¯èƒ½åŸå› ï¼š
- æ¨¡å‹åœ¨450k/EPICå¹³å°è®­ç»ƒ
- 935kå¹³å°çš„æ¢é’ˆè®¾è®¡ä¸åŒ
- éœ€è¦å¹³å°ç‰¹å¼‚æ€§æ ¡å‡†
```

#### 4. **æ¨¡å‹è¾“å‡ºéœ€è¦åå¤„ç†**
```
å¯èƒ½åŸå› ï¼š
- æ¨¡å‹è¾“å‡ºçš„æ˜¯æ ‡å‡†åŒ–å¹´é¾„ï¼ˆéœ€è¦åæ ‡å‡†åŒ–ï¼‰
- æ¨¡å‹è¾“å‡ºçš„æ˜¯å¹´é¾„å·®å¼‚ï¼ˆéœ€è¦åŠ ä¸ŠåŸºå‡†å¹´é¾„ï¼‰
```

**æ£€æŸ¥æ–¹æ³•**ï¼š
```python
# æŸ¥çœ‹åŸå§‹é¢„æµ‹å€¼
print(age_predictions["pred_conditions"])

# å¦‚æœæ˜¯æ ‡å‡†åŒ–å€¼ï¼Œå¯èƒ½éœ€è¦ï¼š
# predicted_age = pred * std + mean
# æˆ–
# predicted_age = pred + baseline_age
```

---

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ•°æ®é¢„å¤„ç†

```python
import pandas as pd
import numpy as np

# è¯»å–æ•°æ®
df = pd.read_csv("data/Sample-251107-Rico-1.csv")

# 1. å¤„ç†ç¼ºå¤±å€¼
# é€‰é¡¹A: åˆ é™¤ç¼ºå¤±å€¼è¿‡å¤šçš„æ¢é’ˆ
missing_ratio = df.isnull().sum() / len(df)
valid_cols = missing_ratio[missing_ratio < 0.2].index  # ä¿ç•™ç¼ºå¤±<20%çš„åˆ—
df_clean = df[valid_cols]

# é€‰é¡¹B: å¡«å……ç¼ºå¤±å€¼
df_clean = df.fillna(df.median())

# 2. æ£€æŸ¥Betaå€¼èŒƒå›´
numeric_cols = df_clean.select_dtypes(include=[np.number]).columns
for col in numeric_cols:
    # ç¡®ä¿åœ¨0-1èŒƒå›´å†…
    df_clean[col] = df_clean[col].clip(0, 1)

# 3. ä¿å­˜æ¸…ç†åçš„æ•°æ®
df_clean.to_csv("data/Sample-251107-Rico-1_cleaned.csv", index=False)
```

### æ–¹æ¡ˆ2: ä½¿ç”¨å¤šä¸ªæ—¶é’Ÿäº¤å‰éªŒè¯

```python
# æ¯”è¾ƒä¸åŒæ¨¡å‹çš„é¢„æµ‹
print(f"age_coté¢„æµ‹: {age_results['predicted_age'].mean():.2f} å²")
print(f"Horvathé¢„æµ‹: {clocks_results['Horvath'].mean():.2f} å²")
print(f"Hannumé¢„æµ‹: {clocks_results['Hannum'].mean():.2f} å²")

# å¦‚æœage_cotå¼‚å¸¸ä½†æ—¶é’Ÿæ­£å¸¸ï¼Œä½¿ç”¨æ—¶é’Ÿç»“æœ
if age_results['predicted_age'].mean() < 0:
    print("âš ï¸ age_coté¢„æµ‹å¼‚å¸¸ï¼Œå»ºè®®ä½¿ç”¨Horvathæˆ–Hannumæ—¶é’Ÿç»“æœ")
```

### æ–¹æ¡ˆ3: æ£€æŸ¥æ¨¡å‹é…ç½®

```python
import yaml

# æŸ¥çœ‹æ¨¡å‹é…ç½®
with open("dependencies/model/config/age_cot.yaml", "r") as f:
    config = yaml.safe_load(f)
    print(config)

# æ£€æŸ¥æ˜¯å¦éœ€è¦åå¤„ç†
# æŸ¥æ‰¾ normalization, scaling, offset ç­‰å‚æ•°
```

### æ–¹æ¡ˆ4: æ·»åŠ åå¤„ç†é€»è¾‘

å¦‚æœç¡®è®¤æ¨¡å‹è¾“å‡ºéœ€è¦åå¤„ç†ï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬ï¼š

```python
# åœ¨ examples/935k_zero_shot_inference.py ä¸­

# åŸå§‹ä»£ç 
age_predictions = trainer.predict(...)
predicted_age = age_predictions["pred_conditions"].flatten()

# æ·»åŠ åå¤„ç†
# æ–¹æ¡ˆA: å¦‚æœæ˜¯æ ‡å‡†åŒ–è¾“å‡º
# predicted_age = predicted_age * age_std + age_mean

# æ–¹æ¡ˆB: å¦‚æœæ˜¯ç›¸å¯¹å¹´é¾„
# predicted_age = predicted_age + baseline_age

# æ–¹æ¡ˆC: å¦‚æœæ˜¯logitè¾“å‡º
# predicted_age = sigmoid(predicted_age) * max_age

# ä¿å­˜ç»“æœ
age_results = pd.DataFrame({
    "sample_id": sample_ids,
    "predicted_age": predicted_age
})
```

---

## ğŸ“Š é¢„æœŸè¾“å‡º

### æ­£å¸¸çš„é¢„æµ‹ç»“æœ

```
å¹´é¾„é¢„æµ‹è´¨é‡æ£€æŸ¥:
  - age_cotæ¨¡å‹é¢„æµ‹èŒƒå›´: 25.3 - 78.9 å²
  - Horvathæ—¶é’Ÿé¢„æµ‹èŒƒå›´: 28.1 - 75.2 å²
  - Hannumæ—¶é’Ÿé¢„æµ‹èŒƒå›´: 30.5 - 72.8 å²
```

### å¼‚å¸¸çš„é¢„æµ‹ç»“æœ

```
å¹´é¾„é¢„æµ‹è´¨é‡æ£€æŸ¥:
  - age_cotæ¨¡å‹é¢„æµ‹èŒƒå›´: -1.6 - 3.2 å²  âŒ

âš ï¸ è­¦å‘Š: æ£€æµ‹åˆ°è´Ÿæ•°å¹´é¾„é¢„æµ‹ï¼
   å¯èƒ½åŸå› :
   1. æ•°æ®è´¨é‡é—®é¢˜ï¼ˆç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ï¼‰
   2. ç‰¹å¾åŒ¹é…ä¸è¶³ï¼ˆå¯ç”¨ç‰¹å¾å¤ªå°‘ï¼‰
   3. å¹³å°å·®å¼‚ï¼ˆ935k vs è®­ç»ƒæ•°æ®å¹³å°ï¼‰
   å»ºè®®: æ£€æŸ¥æ•°æ®è´¨é‡ï¼Œå½“å‰å¯ç”¨ç‰¹å¾æ•°: 1234
```

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### 1. é¦–æ¬¡è¿è¡Œ

```bash
# è¿è¡Œå®Œæ•´è„šæœ¬
python examples/935k_zero_shot_inference.py

# æ£€æŸ¥è¾“å‡º
cat results/935k_predictions/combined_predictions.csv
```

### 2. æ£€æŸ¥ç»“æœ

```python
import pandas as pd

# è¯»å–ç»“æœ
results = pd.read_csv("results/935k_predictions/combined_predictions.csv")

# æŸ¥çœ‹æ‰€æœ‰é¢„æµ‹
print(results.describe())

# æ¯”è¾ƒä¸åŒæ¨¡å‹
print("\næ¨¡å‹å¯¹æ¯”:")
print(f"age_cot: {results['predicted_age'].mean():.2f} Â± {results['predicted_age'].std():.2f}")
print(f"Horvath: {results['Horvath'].mean():.2f} Â± {results['Horvath'].std():.2f}")
print(f"Hannum: {results['Hannum'].mean():.2f} Â± {results['Hannum'].std():.2f}")
print(f"PhenoAge: {results['PhenoAge'].mean():.2f} Â± {results['PhenoAge'].std():.2f}")
print(f"GrimAge: {results['GrimAge'].mean():.2f} Â± {results['GrimAge'].std():.2f}")
```

### 3. æŸ¥çœ‹HTMLæŠ¥å‘Š

```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open results/935k_predictions/analysis_report.html
```

æŠ¥å‘ŠåŒ…å«ï¼š
- âœ… æ‰§è¡Œæ‘˜è¦ï¼ˆæ ·æœ¬æ•°ã€å¹³å‡å¹´é¾„ã€ç™Œç—‡ç‡ï¼‰
- âœ… å¹´é¾„é¢„æµ‹åˆ†æï¼ˆage_cotæ¨¡å‹ï¼‰
- âœ… è¡¨è§‚é—ä¼ æ—¶é’Ÿåˆ†æï¼ˆ5ä¸ªæ—¶é’Ÿï¼‰
- âœ… ç™Œç—‡é¢„æµ‹åˆ†æï¼ˆé£é™©åˆ†å±‚ï¼‰
- âœ… å¹´é¾„-ç™Œç—‡ç›¸å…³æ€§
- âœ… ç»¼åˆç»Ÿè®¡å›¾è¡¨

---

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### æ¨¡å‹æ¶æ„

```
CpGPTæ¨¡å‹ï¼š
- åŸºäºTransformerçš„åºåˆ—æ¨¡å‹
- è¾“å…¥ï¼šDNAç”²åŸºåŒ–Betaå€¼ + DNAåºåˆ—åµŒå…¥
- è¾“å‡ºï¼šå¹´é¾„/ç™Œç—‡/æ—¶é’Ÿé¢„æµ‹

age_cotæ¨¡å‹ï¼š
- ä»»åŠ¡ï¼šå›å½’ï¼ˆå¹´é¾„é¢„æµ‹ï¼‰
- è¾“å‡ºï¼šè¿ç»­å€¼ï¼ˆå¹´é¾„ï¼Œå•ä½ï¼šå²ï¼‰
- è®­ç»ƒæ•°æ®ï¼šå¤šç»„ç»‡ã€å¤šå¹³å°

canceræ¨¡å‹ï¼š
- ä»»åŠ¡ï¼šäºŒåˆ†ç±»ï¼ˆæ­£å¸¸ vs ç™Œç—‡ï¼‰
- è¾“å‡ºï¼šlogit â†’ sigmoid â†’ æ¦‚ç‡
- é˜ˆå€¼ï¼š0.5

clock_proxiesæ¨¡å‹ï¼š
- ä»»åŠ¡ï¼šå¤šä»»åŠ¡å›å½’
- è¾“å‡ºï¼š5ä¸ªæ—¶é’Ÿçš„å¹´é¾„é¢„æµ‹
- ç»´åº¦ï¼š[batch_size, 5]
```

### æ•°æ®æµç¨‹

```
åŸå§‹æ•°æ® (CSV)
    â†“
Arrowæ ¼å¼è½¬æ¢
    â†“
æ¢é’ˆID â†’ åŸºå› ç»„ä½ç½®
    â†“
DNAåºåˆ—åµŒå…¥ç”Ÿæˆ
    â†“
ç‰¹å¾è¿‡æ»¤ï¼ˆåŒ¹é…è¯æ±‡è¡¨ï¼‰
    â†“
CpGPTæ¨¡å‹æ¨ç†
    â†“
åå¤„ç† & ä¿å­˜
    â†“
å¯è§†åŒ– & æŠ¥å‘Šç”Ÿæˆ
```

---

## âœ¨ æ€»ç»“

**æ–°å¢åŠŸèƒ½**:
- âœ… è¡¨è§‚é—ä¼ æ—¶é’Ÿé¢„æµ‹ï¼ˆ5ä¸ªæ—¶é’Ÿï¼‰
- âœ… å¢å¼ºçš„HTMLæŠ¥å‘Š
- âœ… æ•°æ®è´¨é‡æ£€æŸ¥
- âœ… æ¨¡å‹å¯¹æ¯”åˆ†æ

**é—®é¢˜è¯Šæ–­**:
- âœ… è‡ªåŠ¨æ£€æµ‹å¼‚å¸¸é¢„æµ‹
- âœ… æä¾›å¯èƒ½åŸå› 
- âœ… ç»™å‡ºè§£å†³å»ºè®®

**ä½¿ç”¨çš„æ¨¡å‹**:
- âœ… age_cotï¼ˆå¹´é¾„é¢„æµ‹ï¼‰
- âœ… cancerï¼ˆç™Œç—‡é¢„æµ‹ï¼‰
- âœ… clock_proxiesï¼ˆ5ä¸ªè¡¨è§‚é—ä¼ æ—¶é’Ÿï¼‰

**è¾“å‡ºæ–‡ä»¶**:
- âœ… age_predictions.csv
- âœ… cancer_predictions.csv
- âœ… clocks_predictions.csv
- âœ… combined_predictions.csv
- âœ… analysis_report.html

---

**æœ€åæ›´æ–°**: 2025-11-07  
**çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•**: â³ å¾…è¿è¡ŒéªŒè¯

